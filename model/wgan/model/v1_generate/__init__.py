import tensorflow as tf
from ops import *


Q = tf.convert_to_tensor(
    [[[0.9104, -0.6026],
      [0.9313, -0.6246]],

     [[0.7899, -0.0583],
      [1.0840, -0.0889]],

     [[0.5607, -0.4489],
      [0.5187, -0.4945]],

     [[0.2112, -0.2986],
      [0.0287, -0.0985]],

     [[0.6956, -0.4755],
      [0.6510, -0.6647]],

     [[0.9420, -0.0129],
      [0.6693, 0.1246]],

     [[0.6218, -0.4095],
      [0.7876, -0.3318]],

     [[-0.0214, -0.0011],
      [0.2792, -0.2431]]]
                                 )# batch_size,seq_len dim

K = tf.convert_to_tensor([[[-0.3496,  1.2234],
         [-0.5735,  1.0945]],

        [[-0.0364,  0.3603],
         [-0.1396,  0.3983]],

        [[-0.4945, -0.4786],
         [-0.3882, -0.5772]],

        [[-0.5198, -0.0101],
         [-0.9721,  0.1578]],

        [[-0.4507,  0.8135],
         [-0.3366,  0.9180]],

        [[-0.1509,  0.4923],
         [ 0.0963,  0.3740]],

        [[-0.2726, -0.4712],
         [-0.2929, -0.5675]],

        [[-0.7474,  0.3989],
         [-0.6166,  0.2668]]])# batch_size,seq_len dim
key_mask = None

Q, K = relative_position_embedding(Q, K, 4)



def last_dim_repeat_interleave(tensor_v,repeats):
    tensor_shape = tensor_v.get_shape().as_list()
    repeat_tensor_list = []
    for i in range(repeats):
        repeat_tensor_list.append(tensor_v)
    a2 = tf.stack(repeat_tensor_list,-1)

    tensor_shape[-1] = tensor_shape[-1] * repeats
    reshape_shape = tensor_shape
    output = tf.reshape(a2,tensor_shape)
    return output

if __name__ == "__main__":
    # a = tf.reshape(tf.range(27), [3, 3,3])
    # a1 = last_dim_repeat_interleave(a,3)




    with tf.Session() as sess:
        # sess.run(tf.global_variables_initializer())
        Q,K, = sess.run([Q,K])
        print(Q)
        print(K)


# [[[ 0.9104     -0.6026    ]
#   [ 1.0287662   0.4461891 ]]
#
#  [[ 0.7899     -0.0583    ]
#   [ 0.6604944   0.8641216 ]]
#
#  [[ 0.5607     -0.4489    ]
#   [ 0.69636214  0.1692915 ]]
#
#  [[ 0.2112     -0.2986    ]
#   [ 0.09839156 -0.02906956]]
#
#  [[ 0.6956     -0.4755    ]
#   [ 0.9110625   0.18865871]]
#
#  [[ 0.942      -0.0129    ]
#   [ 0.25677705  0.6305182 ]]
#
#  [[ 0.6218     -0.4095    ]
#   [ 0.70474213  0.4834702 ]]
#
#  [[-0.0214     -0.0011    ]
#   [ 0.35541397  0.1035912 ]]]


# [[[-0.3496      1.2234    ]
#   [-1.2308533   0.10877723]]
#
#  [[-0.0364      0.3603    ]
#   [-0.41058406  0.09773305]]
#
#  [[-0.4945     -0.4786    ]
#   [ 0.27595168 -0.6385215 ]]
#
#  [[-0.5198     -0.0101    ]
#   [-0.658012   -0.73273426]]
#
#  [[-0.4507      0.8135    ]
#   [-0.95433605  0.21275836]]
#
#  [[-0.1509      0.4923    ]
#   [-0.26267904  0.2831067 ]]
#
#  [[-0.2726     -0.4712    ]
#   [ 0.31928024 -0.5530884 ]]
#
#  [[-0.7474      0.3989    ]
#   [-0.5576548  -0.37469834]]]

